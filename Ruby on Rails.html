<div style="background-color: #fee; margin: 1em; padding: 10px; border: 1px solid #aaa; text-align: center;"><strong>WARNING: POSSIBLE OUTDATED INFORMATION!</strong><br /><span style="font-size: 90%;">DreamHost does not directly support any of the features described on this page and is not responsible for keeping this content updated or accurate. Use at your own risk! <br />There may be additional information on the <a title="Talk:Ruby on Rails" href="http://wiki.dreamhost.com/Talk:Ruby_on_Rails"> talk page</a>.</span></div>
<div id="toc" class="toc">
<div id="toctitle">
<h2>Contents</h2>
</div>
</div>
<div id="toc" class="toc">
<ul>
<li class="toclevel-1 tocsection-1"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Overview_and_Updates"><span class="tocnumber">1</span> <span class="toctext">Overview and Updates</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#On_DreamHost"><span class="tocnumber">1.1</span> <span class="toctext">On DreamHost</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Advanced:_Other_Ruby_Versions_on_DreamHost"><span class="tocnumber">1.2</span> <span class="toctext">Advanced: Other Ruby Versions on DreamHost</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Previous_Updates"><span class="tocnumber">2</span> <span class="toctext">Previous Updates</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Using_FastCGI"><span class="tocnumber">3</span> <span class="toctext">Using FastCGI</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Quick_Start"><span class="tocnumber">3.1</span> <span class="toctext">Quick Start</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Common_Instructions"><span class="tocnumber">3.1.1</span> <span class="toctext">Common Instructions</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Rails_3"><span class="tocnumber">3.1.2</span> <span class="toctext">Rails 3</span></a></li>
<li class="toclevel-3 tocsection-9"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Older_Versions"><span class="tocnumber">3.1.3</span> <span class="toctext">Older Versions</span></a></li>
<li class="toclevel-3 tocsection-10"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Transferring_an_Existing_Rails_App"><span class="tocnumber">3.1.4</span> <span class="toctext">Transferring an Existing Rails App</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-11"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Common_Gotchas"><span class="tocnumber">3.2</span> <span class="toctext">Common Gotchas</span></a>
<ul>
<li class="toclevel-3 tocsection-12"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Other_Possible_Gotchas"><span class="tocnumber">3.2.1</span> <span class="toctext">Other Possible Gotchas</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-13"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Installing_Ruby_on_Rails"><span class="tocnumber">3.3</span> <span class="toctext">Installing Ruby on Rails</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Automating_deployment_with_Capistrano_.28formerly_SwitchTower.29"><span class="tocnumber">3.4</span> <span class="toctext">Automating deployment with Capistrano (formerly SwitchTower)</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Using_Gems_Installed_in_Your_Home_Directory"><span class="tocnumber">3.5</span> <span class="toctext">Using Gems Installed in Your Home Directory</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Switching_Between_Environments"><span class="tocnumber">3.6</span> <span class="toctext">Switching Between Environments</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Housekeeping"><span class="tocnumber">3.7</span> <span class="toctext">Housekeeping</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Using_Basic_Authorization"><span class="tocnumber">3.8</span> <span class="toctext">Using Basic Authorization</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Nock.27s_Method_for_Rails_2.0.2"><span class="tocnumber">3.9</span> <span class="toctext">Nock's Method for Rails 2.0.2</span></a></li>
<li class="toclevel-2 tocsection-20"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Rails_2.3.5_-_Rack_1.0_already_activated_.28fix.29"><span class="tocnumber">3.10</span> <span class="toctext">Rails 2.3.5 - Rack 1.0 already activated (fix)</span></a></li>
<li class="toclevel-2 tocsection-21"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#See_Also"><span class="tocnumber">3.11</span> <span class="toctext">See Also</span></a></li>
<li class="toclevel-2 tocsection-22"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#External_Links"><span class="tocnumber">3.12</span> <span class="toctext">External Links</span></a>
<ul>
<li class="toclevel-3 tocsection-23"><a href="http://wiki.dreamhost.com/Ruby_on_Rails#Wikis"><span class="tocnumber">3.12.1</span> <span class="toctext">Wikis</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1><span id="Overview_and_Updates" class="mw-headline">Overview and Updates</span></h1>
<dl>
<dd><a class="image" title="Rails Logo" href="http://wiki.dreamhost.com/File:Rails_logo_remix.gif"><img src="http://wiki.dreamhost.com/images/2/27/Rails_logo_remix.gif" alt="Rails Logo" width="110" height="140" /></a></dd>
</dl>
<p>Ruby is a dynamic and multi-paradigm programming language, supporting object-oriented, imperative and functional paradigms. It is the programming language behind the popular Ruby on Rails web application framework.</p>
<h2><span id="On_DreamHost" class="mw-headline">On DreamHost</span></h2>
<p>As of November 9, 2013, DreamHost is running Ruby version 1.8.7 located at <code>/usr/bin/ruby</code>.</p>
<p>To see what is available on your server, from the shell, type:</p>
<pre>   which ruby
   ruby -v
</pre>
<p>DreamHost has also installed <a title="RubyGems" href="http://wiki.dreamhost.com/RubyGems">RubyGems</a> as <code>/usr/bin/gem</code>. You can see what items are installed by doing:</p>
<pre>   gem list | more
</pre>
<p>You can also see the current versions of Ruby, Ruby on Rails and a list of installed gems at <a class="external free" href="http://rails.dreamhosters.com" rel="nofollow">http://rails.dreamhosters.com</a>.</p>
<h2><span id="Advanced:_Other_Ruby_Versions_on_DreamHost" class="mw-headline">Advanced: Other Ruby Versions on DreamHost</span></h2>
<p>You can use <a title="Rbenv" href="http://wiki.dreamhost.com/Rbenv">rbenv</a> or <a class="mw-redirect" title="Rvm" href="http://wiki.dreamhost.com/Rvm">rvm</a> to install other ruby versions on DreamHost</p>
<h1><span id="Previous_Updates" class="mw-headline">Previous Updates</span></h1>
<p><strong>As of mid-2008, DH recommends that Rails apps be run under Passenger. See <a title="Passenger" href="http://wiki.dreamhost.com/Passenger">Passenger</a>. However, as confirmed in an email from DreamHost on 13 May 2012, if you wish to deploy your Rails app to a shared server, and your app depends on a newer version of Rack than is installed on that shared server, then you will need to use FastCGI because Passenger on shared server will always use the system version of Rack: it is not currently possible for a DreamHost user on a shared host to specify that it should use a different version.</strong></p>
<p>""Well, after some research and testing, I figure out a way to deploy Rails apps with Passenger on shared server. I've created a Rails template with all the necessary instructions on <a class="external free" href="https://github.com/paulsutcliffe/dreamhostrails" rel="nofollow">https://github.com/paulsutcliffe/dreamhostrails</a> Hope make your life easier, -Paul Sutcliffe.""</p>
<p>FastCGI, as described below, still works. But Passenger is far easier to configure and use. Tests show that it is as fast or faster than FastCGI. See <a class="external text" href="http://www.modrails.com/" rel="nofollow">Passenger website</a> for more info. To get information on setting up a Rails application using Passenger, see <a title="Getting Started with Ruby on Rails" href="http://wiki.dreamhost.com/Getting_Started_with_Ruby_on_Rails">Getting Started with Ruby on Rails</a>.</p>
<p>You may choose to use FCGI if you wish to have your rails app on a sub-URI of a domain. For example, if you wish <a class="external free" href="http://www.mydomain.com/rails/app1" rel="nofollow">http://www.example.com/rails/app1</a> to go to one rails app and <a class="external free" href="http://www.mydomain.com/rails/app2" rel="nofollow">http://www.example.com/rails/app2</a> to go to a second app, FCGI may be for you.</p>
<p>If you are having issues with your Rails 3 site you should refer to the <a title="Rails 3" href="http://wiki.dreamhost.com/Rails_3">Rails 3 Troubleshooting Guide</a> for help!</p>
<h1><span id="Using_FastCGI" class="mw-headline">Using FastCGI</span></h1>
<p>Note that using <a title="Passenger" href="http://wiki.dreamhost.com/Passenger">Passenger</a> is now the preferred method of running Rails applications in DreamHost's system. <strong>Using FastCGI is not recommended.</strong></p>
<h2><span id="Quick_Start" class="mw-headline">Quick Start</span></h2>
<h3><span id="Common_Instructions" class="mw-headline">Common Instructions</span></h3>
<p><strong>1. Make sure that FastCGI is enabled on your domain.</strong></p>
<p>To do that, go to the <a class="external text" href="https://panel.dreamhost.com/index.cgi?tree=domain.manage&amp;" rel="nofollow">Domains &gt; Manage Domains</a> section of your panel and then click the "Edit" link next to your domain. On the next page make sure "FastCGI Support?" is enabled, and then click the "Save Changes" button.</p>
<p><strong>2. From your shell account, go to the home directory, type:</strong></p>
<p>With the following commands, in <em>italics</em>, for example <em>nameofyourproject</em> is text that should be substituted for its real value.</p>
<dl>
<dd><tt>rails new</tt> <em>nameofyourrailsproject</em></dd>
</dl>
<p>If you want to have a rails application in a subdirectory on your domain, instead type:</p>
<dl>
<dd><tt>ln -s ~/</tt><em>nameofyourrailsproject</em><tt>/public ~/</tt><em>nameofyourdomain</em>/<em>nameofyourrailsproject</em></dd>
</dl>
<p>Warning: if you take the advice above you must check that your private files are not publicly accessible (sometimes they are). To do that, type this address into your browser:</p>
<dl>
<dd><tt>http://</tt><em>yourdomainname</em>/<em>nameofyourrailsproject</em><tt>/config/database.yml</tt></dd>
</dl>
<p>If you can read the file this way, anyone can!</p>
<p>If you want to have a rails application at top-level of your domain, go to the control panel and set the folder of that domain to "<em>nameofyourrailsproject</em><tt>/public</tt>"</p>
<h3><span id="Rails_3" class="mw-headline">Rails 3</span></h3>
<p><a title="Rails 3" href="http://wiki.dreamhost.com/Rails_3#Using_FastCGI">Rails_3#Using_FastCGI</a></p>
<h3><span id="Older_Versions" class="mw-headline">Older Versions</span></h3>
<p><strong>3. Change Permissions</strong> <tt> </tt></p>
<dl>
<dd>chmod 755 public</dd>
<dd>chmod 755 public/dispatch.*</dd>
</dl>
<p> </p>
<p><strong>4. Set up your database</strong> Create your mysql database from the Dreamhost control panel. Change the production:, development:, and test: sections of the config/database.yml to contain the appropriate information for connecting to that database (white space is important- two spaces at the beginning of each line and none at the end):</p>
<pre><code>  adapter: mysql</code>
<code>  database: dbname</code>
<code>  username: username</code>
<code>  password: password</code>
<code>  host: yourdb.example.com</code>
</pre>
<p>(Source: <a class="external text" href="http://gizmoojo.wordpress.com/2006/02/28/6-tips-for-deploying-ruby-on-rails-with-dreamhost/" rel="nofollow">gizmoojo</a>)</p>
<p><strong>5. Visit Your App!</strong></p>
<p>No need to start an extra server like webrick or mongrel (which are not allowed on our shared servers), you can check out your site now by visiting your domain with a web browser.</p>
<p> </p>
<h3><span id="Transferring_an_Existing_Rails_App" class="mw-headline">Transferring an Existing Rails App</span></h3>
<p>If you're transferring a locally working rails app to DH, it is recommend that you:</p>
<ol>
<li>create a dummy rails app using "rails myapp"</li>
<li>copy the created "dispatch.fcgi" into your real app's public/ directory</li>
<li>edit the hidden file called .htaccess in your public/ directory by changing the string "dispatch.cgi" to "dispatch.fcgi":</li>
</ol>
<pre><code>RewriteRule ^(.*)$ dispatch<strong>.fcgi</strong> [QSA,L]</code>
</pre>
<p>4. change all the permissions. From the public/ directory, type the following in the command line:</p>
<pre><code>chmod 755 public</code>
<code>chmod 755 public/dispatch.*</code>
</pre>
<p>5. upload your application and delete the dummy app</p>
<p><strong>Note</strong> At least in one case when developing in rails 2.2.3 and then uploading to Dreamhost the app/controllers/application_controller.rb had to renamed to application.rb</p>
<h2><span id="Common_Gotchas" class="mw-headline">Common Gotchas</span></h2>
<p><strong>1. Application Failed to Start</strong></p>
<p>This is a very generic error message, so the best way to figure out what's going on is to run your dispatch file manually through the shell:</p>
<pre><code>cd public/</code>
<code>./dispatch.fcgi</code>
</pre>
<p>If running dispatch.fcgi from the command line results in</p>
<pre><code>undefined method `downcase' for nil:NilClass</code>
</pre>
<p>in your log/production.log file (<a class="external free" href="http://www.joelpm.com/2007/5/23/mephisto-capistrano-svn-site5" rel="nofollow">http://www.joelpm.com/2007/5/23/mephisto-capistrano-svn-site5</a>) try running:</p>
<pre><code>REQUEST_METHOD=GET ./dispatch.fcgi</code>
</pre>
<p>or possibly:</p>
<pre><code>export REQUEST_METHOD=GET</code>
<code>ruby --debug dispatch.fcgi</code>
</pre>
<p>If you see the HTML for a 500 Error that's usually OK, but you may see a Rails error trace instead. That'll usually point to a syntax error or other goof in the code. But if the dispatch file runs without any output you'll need to check your app's logs in the log/ directory to see what's causing the problem.</p>
<pre><code>tail -50 log/production.log</code>
<code>tail -50 log/development.log</code>
<code>tail -50 log/fastcgi.crash.log</code>
</pre>
<p><strong>Note:</strong> It is strongly discouraged to run your Rails app in Development mode and FastCGI. There's some pretty wicked memory leaks that can result.</p>
<p>If you see the following error when you run your dispatch file, it means that your dispatch file isn't using Unix-friendly line endings:</p>
<pre><code>: bad interpreter: No such file or directory</code>
</pre>
<p>You can fix that by opening the file in a text editor like <strong>vi</strong> or <strong>emacs</strong> and then saving it in Unix format, or using the dos2unix command to convert the file like so:</p>
<pre><code>dos2unix public/dispatch.fcgi</code>
</pre>
<p>Other error messages are usually self-explanatory. And in the absolute worst-case scenario, you'll at least have something to toss at the fine folks that work for DreamHost Tech Support. You can contact them at any time in the <a class="external text" href="https://panel.dreamhost.com/index.cgi?tree=support.msg&amp;" rel="nofollow">Support &gt; Contact Support</a> section of your panel.</p>
<p>You may notice the following errors in your /home/username/logs/example.com/http/error.log file:</p>
<pre>[...] [error] [client ...] FastCGI: comm with (dynamic) server ".../current/public/dispatch.fcgi" aborted: (first read) idle timeout (60 sec)
[...] [error] [client ...] FastCGI: incomplete headers (0 bytes) received from server ".../current/public/dispatch.fcgi"</pre>
<p>This is a very generic error that literally translates to "something went wrong with something somewhere". The above troubleshooting steps will help out with this, too.</p>
<p>One last thing to try out is to add the following to your dispatch.fcgi file (but before the RailsFCGIHandler.process! line):</p>
<pre> class RailsFCGIHandler
 private
   def frao_handler(signal)
     dispatcher_log :info, "asked to terminate immediately"
     dispatcher_log :info, "frao handler working its magic!"
     restart_handler(signal)
   end
   alias_method :exit_now_handler, :frao_handler
 end</pre>
<p>If you have a custom Rails gem installed (2.0.2 in my case) locally (if you don't know what this means this is not applicable to you) and are having the following symptoms: 1. idle timeout for FastCGI in http/error.log 2. running ./dispatch.fcgi works fine 3. you get an application error when trying to access the site from a browser 4. production.log doesn't show any trace of the browser request. Make sure that your ENV['GEM_ENV'] variable mentioned here <a class="mw-redirect" title="Rails" href="http://wiki.dreamhost.com/Rails#Installing_Ruby_on_Rails">Rails#Installing_Ruby_on_Rails</a> is set in the environment.rb file and not the environments/production.rb file. For some reason this makes a difference.</p>
<p><br /> <strong>1.1. Symptom: Browser gives Application Error, but ./dispatch.fcgi works</strong></p>
<p><strong>Details:</strong> The log file (/home/u/logs/domain/http/error.log) gives something like:</p>
<p><code>FastCGI: comm with server "/home/-user-/-websitepath-/public/dispatch.fcgi" aborted: error parsing headers: malformed header 'SET LAYOUT' </code></p>
<p><strong>Solution:</strong> You may have left 1+ 'puts' calls in your code, and they were hit at the point your webapp crashed. Please grep and replace, using Logger if at all. Restart your app and it will be one step closer to working. In the above code, the first puts statement was called during Rails' attempt to process a controller's layout command.</p>
<p><strong>Background:</strong> In Dreamhost's setup the Ruby puts actually outputs the text into the HTTP headers section of the returned page, which then cannot be processed correctly. Running ./dispatch.fcgi at the commandline bypasses those (Apache?) checks so it outputs it as you'd expect.</p>
<p><br /> <strong>1.2. Symptom: As above, browser gives Application Error, but ./dispatch.fcgi works</strong></p>
<p><strong>Details:</strong> The log file (/home/u/logs/domain/http/error.log) gives something like:</p>
<p><code> [Fri Apr 04 12:40:37 2008] [error] [client 65.116.251.178] FastCGI: comm with (dynamic) server "/home/u/domain/public/dispatch.fcgi" aborted: (first read) idle timeout (60 sec) [Fri Apr 04 12:40:37 2008] [error] [client 65.116.251.178] FastCGI: incomplete headers (0 bytes) received from server "/home/u/domain/public/dispatch.fcgi" </code></p>
<p><strong>Solution:</strong> This can be caused if you changed the group of your dispatch.fcgi file, or possibly the group of other files. Change the group of all your files back to your default group. You can find your default group by typing the command 'groups' at the command line; the first group listed is probably the one you want. Use the command 'chgrp -R yourgroup *' in the top level of your application to change the group for all of your files at once.</p>
<p><strong>Background:</strong> The daemon that Dreamhost uses to execute dispatch.fcgi files for the webserver is apparently very picky. It will refuse to run the code if dispatch.fcgi has the wrong group set. When you execute dispatch.fcgi from the command line, no such group check is performed.</p>
<p><br /> <strong>2. Can't connect to local MySQL server through socket '/var/run/mysqld/mysqld.sock' (2)</strong></p>
<p>This means that your Rails app is trying to connect to MySQL through <code>localhost</code>. Make sure that your database.yml file has the proper MySQL host info and that your Rails app is actually running in the mode you want it to be running in. You can find all of your MySQL info in the <a class="external text" href="https://panel.dreamhost.com/index.cgi?tree=goodies.mysql&amp;" rel="nofollow">Goodies &gt; Manage MySQL</a> section of your panel.</p>
<p>The config/database.yml file should have a line like this in the appropriate environment:</p>
<pre>host: mysql.host.for.your.project.com</pre>
<p>If you're running a daemon on a private server and you're getting the "Can't connect" error, you will need to change the first line of the file /public/dispatch.rb from: #!/usr/local/bin/ruby to: #!/usr/bin/env ruby</p>
<p><br /> <strong>3. My Rails app is unacceptably slow!</strong></p>
<p>Apache uses the RewriteRules in your public/.htaccess file to kickstart your app. By default your .htaccess file will have a line like the following:</p>
<pre><code>RewriteRule ^(.*)$ dispatch<strong>.cgi</strong> [QSA,L]</code>
</pre>
<p>This default setting will work, but it's going to be very slow because each time someone makes a request to your Rails app, it'll basically have to load up the whole thing from scratch. A better solution is to use FastCGI instead. To do that, change that line to:</p>
<pre><code>RewriteRule ^(.*)$ dispatch<strong>.fcgi</strong> [QSA,L]</code>
</pre>
<p><br /> <strong>4. Code changes aren't taking effect</strong></p>
<p>When your app is running with FastCGI you'll need to kill all dispatch.fcgi processes if you make changes to your code (just like every time you would normally restart the web server). To do that, run either of these two commands in the shell:</p>
<pre><code>killall -USR1 dispatch.fcgi</code>
<code>killall -USR1 ruby</code>
</pre>
<p>(If both these commands return 'no process killed' you may need to do a 'ps -e' to find the exact name of the process/es you need to kill.)</p>
<p>If you're ever reading install instructions or a Ruby tutorial and it tells you to restart the server, just kill the running dispatch.fcgi processes and you'll be good to go.</p>
<p><br /> <strong>5. Can't access the Analog stats page</strong></p>
<dl>
<dd>Change the rewrite conditions of your .htaccess file in <tt>/public</tt>. An example of working rewrite conditions (assumes fast cgi):</dd>
</dl>
<pre> RewriteEngine On
 RewriteCond %{REQUEST_URI} ^/stats/(.*)$ [OR]
 RewriteCond %{REQUEST_URI} ^/failed_auth.html$
 RewriteRule .* - [L]
 RewriteRule ^$ index.html [QSA]
 RewriteRule ^([^.]+)$ $1.html [QSA]
 RewriteCond %{REQUEST_FILENAME} !-f
 RewriteRule ^(.*)$ dispatch.fcgi [QSA,L]
</pre>
<p><strong>Alternate Solutions (for Passenger)</strong> The alternatives for passenger and stats on our servers are:</p>
<p>Attaching stats to subdomain:</p>
<p>Although Passenger makes it difficult to access stats at <a class="external free" href="http://domain.com/stats" rel="nofollow">http://example.com/stats</a>, it is possible to work around Passenger by attaching the stats package to a subdomain. To do this:</p>
<ol>
<li>Create a subdomain such as stats.example.com in the Dreamhost panel. I recommend that you do not enable stats for this subdomain.</li>
<li>Once stats.example.com exists in your home directory, create symlinks that point to the Dreamhost-generated statistic files:</li>
</ol>
<pre>cd /home/USERNAME/stats.example.com/
for f in `ls /home/USERNAME/logs/example.com/http/html/`; do ln -s /home/USERNAME/logs/example.com/http/html/$f; done
</pre>
<p><strong>Note:</strong> the enclosing quotes around the ls command are not quotes at all - they are backticks! These are usually found near the Escape key on the upper-left of the keyboard.</p>
<p>This method is not perfect. In particular, it will prompt for a username and password for the many resources it tries to fetch at /stats. Other reports beyond the default (monthly) also do not seem to work. I'm sure these issues can be solved through custom Rewrite rules. In the meantime, this is a good way to get basic statistics.</p>
<p>Using the command line:</p>
<ul>
<li><a title="Making stats accessible with htaccess" href="http://wiki.dreamhost.com/Making_stats_accessible_with_htaccess#Alternative_text_mode_method">Making_stats_accessible_with_htaccess#Alternative_text_mode_method</a></li>
</ul>
<p>Using alternative stats programs:</p>
<ul>
<li><a title="AWStats Installation" href="http://wiki.dreamhost.com/AWStats_Installation">AWStats_Installation</a></li>
<li><a class="external free" href="http://whos.amung.us/" rel="nofollow">http://whos.amung.us/</a></li>
<li><a class="external free" href="http://google.com/analytics" rel="nofollow">http://google.com/analytics</a></li>
</ul>
<p> </p>
<h3><span id="Other_Possible_Gotchas" class="mw-headline">Other Possible Gotchas</span></h3>
<ul>
<li>Dreamhost servers are CaSE-seNsiTiVe. If you require any files, they have to use the same case the actual file has (e.g., <code>require 'MD5'</code> will not work, but <code>require 'md5'</code> will).</li>
<li>Make sure your Dreamhost database schema is synchronized with your local database schema. If you're missing a column, rails will throw an error due to your model complaining.</li>
<li>RMagick (and ImageMagick) versions may be out of date. You can <a title="RMagick" href="http://wiki.dreamhost.com/RMagick">install your own versions of RMagick and ImageMagick</a>.</li>
<li>Take out any <code>puts</code> statements in your code, use the Rails <code>&lt;%= myvar %&gt;</code> syntax to print to the page instead.</li>
</ul>
<h2><span id="Installing_Ruby_on_Rails" class="mw-headline">Installing Ruby on Rails</span></h2>
<p>Since DreamHost now has Ruby and Rails installed, the <a title="Ruby on Rails Installation" href="http://wiki.dreamhost.com/Ruby_on_Rails_Installation">Ruby on Rails Installation</a> instructions have been moved. You shouldn't need to install Ruby or Rails unless you have specific requirements that can't be met with the standard config. Even then, you can contact support and request specific gem packages for specific servers if you need them and they will try to accommodate you.</p>
<p>To see what is available on your server, from the shell, type:</p>
<pre> which ruby
 ruby -v
 gem list | more
</pre>
<p>You can also see the current version of Ruby on Rails and a list of installed gems at <a class="external free" href="http://rails.dreamhosters.com" rel="nofollow">http://rails.dreamhosters.com</a>.</p>
<p><br /> <strong>Outdated Rails version</strong> Dreamhost keep the last three installed versions available by default. It is highly recommended to freeze the rails version your application is using, so when your version gets outdated the application will not suddenly stop working (It happened to me, and it's not fun). To do that, run the following command on the server. Make sure the current directory is the Rails app directory.</p>
<pre>rake rails:freeze:edge TAG=rel_2-1-0
</pre>
<p>Make sure you input the correct version number. One possible gotcha can be a faulty boot.rb file, make sure it fits the rails version you're using.</p>
<p> </p>
<h2><span id="Automating_deployment_with_Capistrano_.28formerly_SwitchTower.29" class="mw-headline">Automating deployment with Capistrano (formerly SwitchTower)</span></h2>
<p><a class="external text" href="http://manuals.rubyonrails.com/read/book/17" rel="nofollow">Capistrano (formerly SwitchTower)</a> is an additional utility to automate the deployment, migration, upgrades and rollbacks (should anything go horribly wrong!) of your Rails application. Full details for using it along with DreamHost can be found on the <a title="Capistrano" href="http://wiki.dreamhost.com/Capistrano">Capistrano</a> page, or for the earlier SwitchTower, here: <a class="external text" href="http://woss.name/2006/01/22/using-switchtower-with-ruby-on-rails-and-dreamhost/" rel="nofollow">Using SwitchTower with Ruby on Rails and DreamHost</a>.</p>
<p><a class="external text" href="http://blog.commonkitchen.com/2007/06/16/deploying-to-dreamhost-with-capistrano/" rel="nofollow">Deploying to Dreamhost with Capistrano</a> is a blog posting by Parker Morse detailing some of the non-trivial aspects of using Capistrano with your Dreamhost hosting.</p>
<p> </p>
<pre>#create the_rails_app_production database
#setup db.the-rails-app.com db server
#setup domain the-rails-app.com to look in ./current


#!/bin/bash
cd ~/the_rails_app
mkdir config/deploy
for e in %(staging production testing); touch config/deploy/$e.rb; done;

echo '#!/bin/bash' &gt; script/spin
echo 'touch tmp/restart' &gt;&gt; script/spin &amp;&amp; chmod 755 script/spin


# dreamhost only:
# change config/environment.rb to require rails 2.2.2
# change config/database.yaml (production:) and delete the socket ref for mysql
# add symlink to older application.rb controller

svn ci -m 'initial capify'

capify .
cap deploy:setup
cap deploy:check
cap deploy:update #fix all errors until this succeeds
cap deploy:migrate #initial migration of db
#if using 2.2.2 be sure to symlink application_controller.rb to application.rb

cap deploy:start


# if you modify anything, be sure to checkin and deploy:update again
</pre>
<h2><span id="Using_Gems_Installed_in_Your_Home_Directory" class="mw-headline">Using Gems Installed in Your Home Directory</span></h2>
<p>You may install gems which are not pre-installed on Dreamhost's servers in your home directory. Assuming you use bash, do the following:</p>
<pre>[server]$ mkdir ~/.gems
[server]$ cat &gt;&gt; ~/.bash_profile
export GEM_HOME=$HOME/.gems
export GEM_PATH=$GEM_HOME:/usr/lib/ruby/gems/1.8
</pre>
<p>Then press CTRL+D to exit <code>cat</code> and return to the command prompt. You may then install gems in the usual way (e.g. <code>gem install <var>gem_name</var></code>).</p>
<p>The .bash_profile method above resulted in the following error: Could not find RubyGem sources (&gt; 0.0.0) when I tried installing a gem but the instructions on altering your .gemrc file below worked perfectly. HOWEVER, without altering the .bash_profile rake kept complaining about not seeing my locally installed gems even when I passed it GEM_HOME and GEM_PATH manuall. So, you may need both.</p>
<ul>
<li>An alternative to setting the <code>GEM_PATH</code> environment is to create a ~/.gemrc file with the following contents:</li>
</ul>
<pre>gemhome: /home/&lt;YOUR USER NAME HERE&gt;/.gems
gempath:
  - /home/&lt;YOUR USER NAME HERE&gt;/.gems
  - /usr/lib/ruby/gems/1.8
</pre>
<p>In order to get your rails app to use gems installed in your home directory, you first have to unpack them in RAILS_ROOT/vendor. Therefore, to be able to <code>require</code> them in your code, enter the RAILS_ROOT/vendor directory and do the following:</p>
<pre>gem unpack <var>gem_name</var>
</pre>
<p>where <code>gem_name</code> is the name of the gem you wish to use.</p>
<p>If your gem doesn't add itself to the load path, then it might not load up as expected. You'll have to add it yourself, by putting something like:</p>
<pre>config.load_paths += %W( #{RAILS_ROOT}/vendor/<var>gem_name</var>/lib )
</pre>
<p>in your environment.rb file, obviously replacing gem_name with whatever gem you're loading (remember to include the version number).</p>
<p>As an alternative to using RAILS_ROOT/vendor, you can put the following line at the top of your config/environment.rb file in your rails application(s):</p>
<pre>ENV['GEM_PATH'] = File.expand_path('~/.gems') + ':/usr/lib/ruby/gems/1.8'
</pre>
<p>This allows multiple rails applications to share the same gems directory.</p>
<p>There's also a good How To on this topic here: <a class="external text" href="http://www.nateclark.com/articles/2006/10/20/dreamhost-your-own-packages-and-gems" rel="nofollow">DreamHost Your Own Packages and Gems</a></p>
<p>Note: I believe the local installed gems must be unpacked to the app's vendor directory. I spent several days investigating an problem with my app that keeps showing the 500 error page after the dispatch.fcgi silently dies when serving a request. What solved it in the end was removing references to the ~/.gems dir in both dispatch.fcgi and environment.rb plus freezing the rails gems to the vendor dir.</p>
<h2><span id="Switching_Between_Environments" class="mw-headline">Switching Between Environments</span></h2>
<p>Rails can be used in different <em>enivronments</em>. Each environment will change the behaviour of your application in small ways, and can be used to help you with each stage of the development cycle. The three environments are:</p>
<p>1. <strong>Development</strong> - (not support on dreamhost) In development, you are generally changing the code rapidly and reloading your application. You don’t need to restart the server or the application to see your changes. Rails error messages will be technically descriptive.</p>
<p>2. <strong>Test</strong></p>
<p>3. <strong>Production</strong> - In production, your code is expected not to change, so models and controllers are cached to run faster. That means no repeated trips to the database to ask about columns and types, resulting in a quicker loading application. Rails error messages are very concise and non technical.</p>
<p>The following instructions are for Dreamhost Rails applications on Apache servers (by default they are), with FastCGI support selected. FastCGI is not supported <em>out of the box</em> so if you suspect your application to not be using FastCGI then see the <em>Configuring Your Application</em> section above.</p>
<p>Open the file <tt>environment.rb</tt> in the <strong>config</strong> directory and replace the line:</p>
<pre><strong>RAILS_ENV = ENV['RAILS_ENV'] || 'production'</strong>
</pre>
<p>with</p>
<pre><strong>RAILS_ENV = 'development'</strong>
</pre>
<p>You can replace <em>development</em> with <em>production</em> in the line above to switch back to that environment again.</p>
<h2><span id="Housekeeping" class="mw-headline">Housekeeping</span></h2>
<p>No one really enjoys housework, but with Rails there are sometimes a few chores that need to be done.</p>
<p><strong>Clearing Out Sessions</strong></p>
<dl>
<dd>If you use sessions in your application, you have to periodically purge old session files from your <tt>tmp</tt> directory. If you do not purge the old files eventually your application may become unstable. The following can be run as a server <a class="external text" href="https://panel.dreamhost.com/kbase/index.cgi?area=2506&amp;keyword=cron%20job" rel="nofollow">cron job</a>:</dd>
</dl>
<pre>[server]$ <strong>find /tmp/ -name 'sess_*' -ctime +1 -exec rm -fv \{\} \;</strong>
</pre>
<dl>
<dd>This will delete ruby session files from the <tt>tmp</tt> directory. The -f flag to rm is a bit dangerous, but asking questions for every file you are not allowed to delete will take forever. The v switch will print out every file that gets deleted.</dd>
</dl>
<dl>
<dd>You can restrict the find command to your own files with the -user flag, and keep find from trying to go where it's not allowed to go with -maxdepth:</dd>
</dl>
<pre>[server]$ <strong>find /tmp/ -maxdepth 1 -name 'sess_*' -user 'yourusername' -ctime +1 -exec rm -f \{\} \;</strong>
</pre>
<dl>
<dd>'yourusername' is the username that your rails app runs as, specified in the "Web Hosting" options of the Dreamhost Panel.</dd>
</dl>
<h2><span id="Using_Basic_Authorization" class="mw-headline">Using Basic Authorization</span></h2>
<p>If you need to use basic authorization (for example, to support authenticated RSS feeds), you can do so in a hackish way with this rule in mod_rewrite:</p>
<pre> RewriteRule ^(.*)$ dispatch.fcgi [E=X_http_AUTHORIZATION:%{http:AUTHORIZATION},QSA,L]
</pre>
<p>The controller to do is described on the <a class="external text" href="http://wiki.rubyonrails.org/rails/pages/HowtoAuthenticateWithHTTP" rel="nofollow">Rails Wiki</a>, except that you need the final elsif here:</p>
<pre> def get_auth_data 
   user, pass = "", "" 
   # extract authorisation credentials 
   if request.env.has_key? 'X-HTTP_AUTHORIZATION' 
     # try to get it where mod_rewrite might have put it 
     authdata = request.env['X-HTTP_AUTHORIZATION'].to_s.split 
   elsif request.env.has_key? 'Authorization' 
     # for Apace/mod_fastcgi with -pass-header Authorization 
     authdata = request.env['Authorization'].to_s.split 
   elsif request.env.has_key? 'HTTP_AUTHORIZATION' 
     # this is the regular location 
     authdata = request.env['HTTP_AUTHORIZATION'].to_s.split  
   elsif request.env.has_key? 'REDIRECT_REDIRECT_X_http_AUTHORIZATION'
     # special Dreamhost header
     authdata = @request.env['REDIRECT_REDIRECT_X_http_AUTHORIZATION'].to_s.split
   end 
</pre>
<p>This solution was created by <a class="external text" href="http://discussion.dreamhost.com/showthreaded.pl?Cat=&amp;Board=forum_programming&amp;Number=40653&amp;Search=true&amp;Forum=All_Forums&amp;Words=http%20AUTHORIZATION&amp;Match=And&amp;Searchpage=0&amp;Limit=25&amp;Old=1year&amp;Main=40595" rel="nofollow">psross</a>.</p>
<p>I streamlined this solution to be more general to most all Apache setups, I can't imagine how this could be a security risk but YMMV:</p>
<pre> def get_auth_data 
   user, pass, authdata = nil, nil, nil
   request.env.each do |key,value|
     if /HTTP_AUTHORIZATION$/.match(key)
       authdata = value.to_s.split
     end
   end
   # at the moment we only support basic authentication 
   if authdata and authdata[0] == 'Basic' 
     user, pass = Base64.decode64(authdata[1]).split(':')[0..1] 
   end 
   return [user, pass] 
 end
</pre>
<p>-- <a class="external text" href="http://www.codekitchen.net/" rel="nofollow">BrianPalmer</a>.</p>
<h2><span id="Nock.27s_Method_for_Rails_2.0.2" class="mw-headline">Nock's Method for Rails 2.0.2</span></h2>
<p>This worked for me on 4/24/08, but I make no promises</p>
<ul>
<li>cd ~/</li>
<li>rails your_app_name -d mysql</li>
<li>copy app/, database.yml, routes.rb, db/</li>
<li>change public/.htaccess from .cgi to .fcgi (line 32)</li>
<li>put your app into production mode (uncomment line 5 in environment.rb)</li>
<li>run rake db:migrate RAILS_ENV=production</li>
<li>chmod -R 755 ~/your_app_name/app</li>
<li>rm your_app_name/public/index.html</li>
<li>ln -s ~/your_app_name/public ~/example.com/link_to_my_app</li>
<li>killall -USR1 dispatch.fcgi</li>
<li>killall -USR1 ruby</li>
</ul>
<h2><span id="Rails_2.3.5_-_Rack_1.0_already_activated_.28fix.29" class="mw-headline">Rails 2.3.5 - Rack 1.0 already activated (fix)</span></h2>
<p>When using Rails 2.3.5 you will get a problem from Passenger saying Rack 1.0.1 cannot be loaded because Rack 1.0 is already activated.</p>
<p>One way to solve this is by freezing Rails and unpack the Rack gem into vendor/gems/rack-1.0.1</p>
<p>Once Rails and Rack are in the vendor/rails and vendor/gems/rack-1.0.1 you must modify action_controller in file: <strong>vendor/rails/actionpack/lib/action_controller.rb</strong></p>
<p>In line numbers 34 and 35 must be commented out and add the following to load rack from vendor/gems</p>
<pre> load "#{RAILS_ROOT}/vendor/gems/rack-1.0.1/lib/rack.rb"
</pre>
<p>The end result should look something like this:</p>
<pre> #gem 'rack', '~&gt; 1.0.1'
 #require 'rack'
 load "#{RAILS_ROOT}/vendor/gems/rack-1.0.1/lib/rack.rb"
</pre>
<p>The real problem is that Passenger already loads Rack 1.0 and I believe Passenger must load 1.0.1 in order for this hack to go away.</p>
<h2><span id="See_Also" class="mw-headline">See Also</span></h2>
<ul>
<li><a title="Getting Started with Ruby on Rails" href="http://wiki.dreamhost.com/Getting_Started_with_Ruby_on_Rails">Getting Started with Ruby on Rails</a></li>
<li><a title="Rails 3" href="http://wiki.dreamhost.com/Rails_3">Rails 3</a></li>
<li><a title="Rails troubleshooting" href="http://wiki.dreamhost.com/Rails_troubleshooting">Rails troubleshooting</a></li>
</ul>
<h2><span id="External_Links" class="mw-headline">External Links</span></h2>
<ul>
<li><a class="external text" href="http://www.ruby-lang.org/" rel="nofollow">Ruby</a></li>
<li><a class="external text" href="http://www.rubyonrails.com/" rel="nofollow">Ruby on Rails</a></li>
<li><a class="external text" href="http://rubygems.rubyforge.org/wiki/wiki.pl" rel="nofollow">RubyGems</a></li>
</ul>
<ul>
<li><a class="external text" href="http://wiki.rubyonrails.com/rails/show/Howtos" rel="nofollow">Howtos in Rails Wiki</a></li>
<li><a class="external text" href="http://www.pragmaticprogrammer.com/titles/rails/index.html" rel="nofollow">Agile Web Development with Rails</a> (Book/Bible)</li>
<li><a class="external text" href="http://sourceforge.net/projects/locomotive/" rel="nofollow">Locomotive</a> Excellent Mac OS X Rails development environment (Rails, lighttpd, SQLite)</li>
<li><a class="external text" href="http://www.railslodge.com/" rel="nofollow">Ruby on Rails plugin directory</a></li>
</ul>
<h3><span id="Wikis" class="mw-headline">Wikis</span></h3>
<ul>
<li><a title="RubyGems" href="http://wiki.dreamhost.com/RubyGems">RubyGems</a></li>
<li><a title="Eruby" href="http://wiki.dreamhost.com/Eruby">Eruby</a></li>
<li><a class="extiw" title="wikipedia:Ruby programming language" href="http://en.wikipedia.org/wiki/Ruby_programming_language">Wikipedia:Ruby programming language</a></li>
</ul>
